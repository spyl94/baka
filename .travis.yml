language: php

php:
  - 5.5
  - 5.6

cache:
    directories:
        - ~/.composer/cache

git:
  submodules: false

before_script:
 - cp app/config/parameters.yml.travis app/config/parameters.yml
# - cp .travis-composer-config.json ~/.composer/config.json
 - composer install --no-progress --prefer-dist
 - php app/console doctrine:database:create --env=test
 - php app/console doctrine:schema:create --env=test
 - php app/console doctrine:fixtures:load -n --env=test

script: bin/phpspec run && bin/behat

after_success:
    - openssl aes-256-cbc -K $encrypted_168c5169b1c4_key -iv $encrypted_168c5169b1c4_iv -in id_rsa.enc -out id_rsa -d
    - bundle install
    - if [[ $TRAVIS_BRANCH = 'master' ]]; then
        bundle exec cap deploy
      fi

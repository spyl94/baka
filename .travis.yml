language: php

php:
  - 5.5
  - 5.6

git:
    - submodules: false

cache:
    directories:
        - ~/.composer/cache

before_script:
 - cp app/config/parameters.yml.travis app/config/parameters.yml
 - cp .travis-composer-config.json ~/.composer/config.json
 - composer install --no-progress --prefer-dist
 - php app/console doctrine:database:create --env=test
 - php app/console doctrine:schema:create --env=test
 - php app/console doctrine:fixtures:load -n --env=test

script: bin/phpspec run && bin/behat

after_success:
    - openssl aes-256-cbc -K $encrypted_0a6446eb3ae3_key -iv $encrypted_0a6446eb3ae3_key -in app/config/travis_deploy.txt.enc -out travis_deploy.txt -d
    - bundle install
    - [[ $TRAVIS_BRANCH = 'master' ]] && bundle exec cap deploy
